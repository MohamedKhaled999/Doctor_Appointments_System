<div style="padding-top:80px">
    <div class="col-12 pt-3 d-flex justify-content-center gap-3 list-unstyled p-0">
        <button class="btn" [ngClass]="{'active-tab patient-tab-active': activeTab === 'details'}"
            (click)="switchTab('details')"><span>Details</span></button>
        <button class="btn" [ngClass]="{'active-tab patient-tab-active': activeTab === 'appointments'}"
            (click)="switchTab('appointments')"><span>My Appointments</span></button>
    </div>
    <!-- Details Tab -->
    <div id="patient-tab-1" class="row w-75 patient-profile-container mx-auto p-3 shadow-sm rounded-4" *ngIf="activeTab === 'details'">
        <div class="col-12 col-md-2 text-center">
            <!-- <img id="patient-profile-image" src="/images/default.png" alt="patient image"
                class="rounded-circle w-100" /> -->
        </div>
        <form method="post" class="form-container d-flex flex-column justify-content-between gap-3 col-12 col-md-10 p-3"
            (ngSubmit)="onSubmit()" [formGroup]="patientForm">
            <div class="text-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
            <div class="row justify-content-between">
                <div class="col-12 col-md-6">
                    <label for="firstName" class="form-label my-1">First Name</label>
                    <input name="firstName" formControlName="firstName" id="firstName"
                        class="login-form-input rounded-1" readonly />
                </div>
                <div class="col-12 col-md-6">
                    <label for="lastName" class="form-label my-1">Last Name</label>
                    <input name="lastName" formControlName="lastName" id="lastName" class="login-form-input rounded-1"
                        readonly />
                </div>
            </div>
            <div class="row justify-content-between">
                <div class="row justify-content-between">
                    <div class="col-12 col-md-6">
                        <label for="email" class="form-label my-1">Email</label>
                        <input name="email" formControlName="email" id="email" class="login-form-input rounded-1" readonly />
                    </div>
                    <div class="col-12 col-md-6">
                        <label for="phoneNumber" class="form-label my-1">Phone Number</label>
                        <input name="phoneNumber" formControlName="phoneNumber" id="phoneNumber"
                        class="login-form-input rounded-1" />
                        <span class="text-danger"
                        *ngIf="patientForm.get('phoneNumber')?.invalid && (patientForm.get('phoneNumber')?.touched || patientForm.get('phoneNumber')?.dirty)">
                        <span *ngIf="patientForm.get('phoneNumber')?.errors?.['required']">Phone Number is required.</span>
                        <span *ngIf="patientForm.get('phoneNumber')?.errors?.['pattern']">Invalid phone number
                            format.</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="accordion" id="accordionExample">
                <div class="accordion-item" id="patient-more-information">
                    <h2 class="accordion-header">
                        <button class="accordion-button position-relative" id="patient-more-information-button" (click)="toggleAccordion()"
                            type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true"
                            aria-controls="collapseOne">
                            <span class="px-1 mx-auto">More Information <i id="patient-arrow-icon" [ngClass]="{'up': isAccordionOpen}"
                                    class="fa-solid fa-arrow-down ms-1"></i></span>
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div>
                                <label for="birthDate" class="form-label my-1">Birth Date</label>
                                <input name="birthDate" formControlName="birthDate" id="birthDate"
                                    class="login-form-input rounded-1" readonly />
                            </div>
                            <div>
                                <label for="governorate" class="form-label my-1">Governorate</label>
                                <select name="governorate" formControlName="governorate" class="form-select">
                                    <option value="0" selected disabled>Select Governorate</option>
                                    @for(governorate of governorates; track $index)
                                    {
                                    <option value="{{governorate}}">{{governorate}}</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                <button routerLink="/account/change-password" class="btn login-submit">Change Password</button>
                <input type="submit" class="btn login-submit" [disabled]="patientForm.invalid" value="Save Changes" />
            </div>
        </form>
    </div>

    <!-- Appointments Tab -->
    <div id="patient-tab-2" class="row w-75 patient-appointments-container mx-auto shadow-sm rounded-4" *ngIf="activeTab === 'appointments'">
        <swiper-container class="w-100 h-100 p-3 mx-auto position-relative" pagination="true"
            pagination-clickable="true" slides-per-view="1" grid-rows="2" space-between="40">
            @if (patient?.appointments != null && patient?.appointments?.length != 0)
            {
            @for(appointment of patient?.appointments; track $index)
            {
            <swiper-slide
                class="patient-appointment-card p-3 shadow overflow-hidden d-flex gap-3 bg-white rounded-3 align-items-center position-relative"
                data-aos="fade-left">
                <app-patient-appointment [appointment]="appointment"></app-patient-appointment>
            </swiper-slide>
            }
            }
            @else
            {
            <h2 class="text-center mt-5">No Appointment has been booked so far</h2>
            }
        </swiper-container>
    </div>
</div>

<div class="modal fade" id="SP-RevForm" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Rating Form</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" (ngSubmit)="onSubmit()" [formGroup]="reviewForm">
                <div class="modal-body">
                    <input type="hidden" class="SP-appID" name="AppID" />
                    <div class="mb-3 SP-review">
                        <label for="review" class="form-label">Your thoughts on the appointment with ?</label>
                        <textarea class="form-control SP-reviewText" id="review" name="review" required
                            rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="rate" class="form-label">Rating</label>
                        <input class="form-control" id="rate" name="rate" required type="number" min="1" max="5"
                            value="5">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn SP-bookBTN col-12 SP-CalSubmit">Add</button>
                    <button type="button" class="btn SP-bookBTN col-12" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>
